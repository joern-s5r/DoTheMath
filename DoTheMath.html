<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Do the math!</title>
	<!-- place bootsrap css link in the <head> -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	  <!-- bootstrap icons -->
	  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
	  <!-- bootstrap slider -->
	  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/css/bootstrap-slider.min.css">
	  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/bootstrap-slider.min.js"></script>
	
	<style>

	.my-hidden {
		display: none;
	}

	.slider-handle.custom {
		background: transparent none;
	}

	.mathAddition .slider-handle.custom::before {
		content: '\002B';
	}

	.mathSubtraction .slider-handle.custom::before {
		content: '\2212';
	}

	</style>
	
	<script>

		document.addEventListener("DOMContentLoaded", function() {
			initButtons();

			// init slider
			new Slider("#rangeAddition", {});
			new Slider("#rangeSubtraction", {});
		});

		function initButtons(){
			document.getElementById("do-calculation").addEventListener('click', doCalculation);
			document.getElementById("do-cancel-calculation").addEventListener('click', doCancelCalculation);
			document.getElementById("do-check-calculation").addEventListener('click', doCheckCalculation);
		}

		function doCalculation(){
			document.getElementsByClassName("start-view")[0].classList.add("my-hidden");
			document.getElementsByClassName("calculation-view")[0].classList.remove("my-hidden");

			const operators = ["+", "+", "+", "-"];
			const taskContainerBase = document.getElementsByClassName("task-container")[0];

			const taskCount = document.getElementById("taskCount").value;
			for (let i = 0; i < taskCount; i++) {
				const taskContainer = taskContainerBase.cloneNode(true);
				taskContainer.classList.remove("my-hidden");
				taskContainer.getElementsByTagName("label")[0].setAttribute("for", "task-"+i);
				taskContainer.getElementsByTagName("input")[0].setAttribute("id", "task-"+i);

				const operatorIndex = getRandomInt(0, operators.length-1);
				const operator = operators[operatorIndex];
				const operand1 = getRandomInt(0, 20);
				const operand2 = getRandomInt(0, 20);
				taskContainer.getElementsByTagName("label")[0].innerText = operand1 + " " + operator + " " + operand2;

				let result = "";
				if(operator === "+"){
					result = operand1 + operand2;
				}
				else if (operator === "-"){
					result = operand1 - operand2;
				}
				taskContainer.setAttribute("data-task-result", result)
				taskContainerBase.after(taskContainer);
			}

		}

		function doCancelCalculation(){
			document.getElementsByClassName("start-view")[0].classList.remove("my-hidden");
			document.getElementsByClassName("calculation-view")[0].classList.add("my-hidden");

			const taskList = document.querySelectorAll(".task-container:not(.my-hidden)");
			taskList.forEach((task) => {
				task.remove();
			});
		}

		function doCheckCalculation(){

			const taskList = document.querySelectorAll(".task-container:not(.my-hidden)");
			taskList.forEach((task) => {

				const resultWanted = task.getAttribute("data-task-result");
				const resultActual = task.getElementsByTagName("input")[0].value;
				if(resultWanted === resultActual){
					task.getElementsByTagName("input")[0].classList.remove("is-invalid");
					task.getElementsByTagName("input")[0].classList.add("is-valid");
				}
				else{
					task.getElementsByTagName("input")[0].classList.remove("is-valid");
					task.getElementsByTagName("input")[0].classList.add("is-invalid");
				}
			});
		}

		function getRandomInt(min, max) {
			const minCeiled = Math.ceil(min);
			const maxFloored = Math.floor(max);
			return Math.floor(Math.random() * (maxFloored - minCeiled + 1) + minCeiled); // The maximum is inclusive and the minimum is inclusive
		}
	</script>
	
  </head>
  <body>
    <div class="start-view ">
		<div class="container">
			<div class="row">
			</div>
		  <div class="row">
			<div class="col">
			</div>
			<div class="col">
			  <h1>Start</h1>

				  <div class="mb-3">
					<label for="taskCount" class="form-label">Anzahl Aufgaben</label>
					<input type="number" class="form-control" id="taskCount" aria-describedby="taskCountHelp" value="3" min="1">
					<div id="taskCountHelp" class="form-text">Wieviel Aufgaben möchtest du rechnen?</div>
				  </div>

				<div class="mb-3 mathAddition">
					<input type="text" data-slider-handle="custom" id="rangeAddition"/>
				</div>
				<div class="mb-3 mathSubtraction">
					<input type="text" data-slider-handle="custom" id="rangeSubtraction"/>
				</div>
				<div class="mb-3">
					<label for="rangeMultiplication" class="form-label">
						<i class="bi bi-x-circle"></i>
					</label>
					<input type="range" class="form-range" id="rangeMultiplication">
				</div>
				<div class="mb-3">
					<label for="rangeDivision" class="form-label">
						<i class="bi bi-slash-circle"></i>
					</label>
					<input type="range" class="form-range" id="rangeDivision">
				</div>

				<button id="do-calculation" type="button" class="btn btn-primary float-end" >Los geht's
					<i class="bi bi-emoji-heart-eyes"></i>
				</button>

			</div>
			<div class="col">
			</div>
		  </div>
			<div class="row">
			</div>
		</div>
	</div>
	<div class="calculation-view my-hidden">
		<div class="container">
		  <div class="row">
			<div class="col">
			</div>
			<div class="col">
			  <h1>Rechnen</h1>

				<div class="container my-hidden task-container">
					<div class="row mb-3">
						<label for="task" class="col-sm-6 col-form-label"></label>
						<div class="col-sm-6">
							<input type="number" class="form-control" id="task">
						</div>
					</div>
				</div>
				  <button id="do-cancel-calculation" type="button" class="btn btn-secondary m-1" >Abbrechen</button>
				  <button id="do-check-calculation" type="button" class="btn btn-primary m-1 float-end" >Überprüfen</button>


			</div>
			<div class="col">
			</div>
		  </div>
		</div>
	</div>
	<!-- place bootsrap js link before </body> -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

  </body>
</html>
